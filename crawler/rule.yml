# 唯一标识此规则
id: "xx"

# 规则每更新一次，版本号必须增加
version: 1

name: "xx"

# 别名可以是中文
alias: "xx"

# 分组（默认是default）
group: "default"

# 优先级在同一group内有效，0为最高优先级
priority: 100

# URL匹配的正则表达式
patterns:
  - "xx.com"
  - "xx.hk"

# 每个页面的超时时间（对loop无效）
page_load_timeout: "10s"

# 如果prepare的eval不为空，必须返回true流程才会继续
# true或"true"表示true，其他任何值都表示false
prepare:
  eval: "js"
  wait_when_ready: "2s"

fields:
  # 不要使用Javascript关键字和符号以避免冲突（可以使用下划线）
  - name: "product_id"
    # JS表达式/代码块，如果有返回值，会转换为字符串
    eval: "js"
    # 是否采集eval结果
    # 默认false，表示不采集并且eval返回值也不会作为Javascript全局变量（用于无需返回的eval）
    # 如果为true，表示采集并且eval返回值会作为Javascript全局变量，后续可直接使用
    export: true

  - name: "product_source"
    alias: "平台"
    # value替代eval，返回常量
    value: "3"
    export: true

  # eval和value并存
  # value会作为eval的局部变量（变量名就叫value），但仍然以eval返回值作为采集结果和全局变量
  - name: "product_price"
    alias: "价格"
    eval: "js"
    value: '1234'
    export: true

  - name: "comments_scroll"
    alias: "滚动"
    eval: "js"
    # eval之后等待指定时间再继续
    wait: "500ms"

# 无论是否有loop，都会先采集fields
# loop内部执行顺序：prepare_eval-->prepare_wait_when_ready-->loop(eval-->break-->next-->wait)
loop:
  name: "page"
  alias: "分页"
  # 设置回调周期，例如每循环5（默认为10）次回调一次（回调的时候参数即是这5次循环eval的数据）
  export_cycle: 5
  # 如果prepare的eval不为空，必须返回true流程才会继续
  # true或"true"表示true，其他任何值都表示false
  prepare:
    eval: "js"
    wait_when_ready: "2s"
  # eval次数会作为全局变量（变量名叫count，从1开始）
  eval: "js"
  # 返回true终止循环（true或"true"表示true，其他任何值都表示false）
  break: "js"
  # 下一次eval前执行（如翻页）
  next: "js"
  # next执行过后等待指定时间后再开始下一轮循环的eval
  wait: "2s"